<?php/** * 0元淘订单管理 * * */defined('InSystem') or exit('Access Invalid!');class zero_orderModel extends Model{    public function __construct(){        parent::__construct('zero_order');    }    /**     * 新增     *     * @param array $insert 数据     * @param string $table 表名     */    public function addData($insert) {        $result = $this->table('zero_order')->insert($insert);        return $result;    }    /**     * 列表     *     * @param array $condition 条件     * @param string $field 字段     * @param string $group 分组     * @param string $order 排序     * @param int $limit 限制     * @param int $page 分页     * @param boolean $lock 是否锁定     * @return array 二维数组     */    public function getList($condition, $field = '*', $group = '',$order = '', $limit = 0, $page = 0, $lock = false, $count = 0) {        return $this->table('zero_order')->field($field)->where($condition)->group($group)->order($order)->limit($limit)->page($page, $count)->lock($lock)->select();    }    /**     * 列表     *     * @param array $condition 条件     * @param string $field 字段     * @param string $order 排序     * @return array 二维数组     */    public function getAllList($condition, $field = '*',$order='') {        return $this->table('zero_order')->field($field)->where($condition)->order($order)->select();    }    /**     *     * 获取会员订单列表     * @param array $condition     */    public function getMemberOrderList($condition=array(),$page=0){        //所需字段        $field = 'zero_order.order_id,zero_order.order_state,zero_order.order_sn,zero_order.pay_sn,zero_order.shipping_amount,zero_order.shipping_code,zero_goods.goods_name,zero_goods.goods_id,zero_goods.goods_progress,zero_goods.goods_join_num,zero_goods.goods_surplus_num,zero_goods.goods_total_num,zero_goods.goods_image_index';        $new_condition = array();        if($condition['order_state']){            $new_condition['zero_order.order_state'] = $condition['order_state'];        }        if($condition['buyer_id']){            $new_condition['zero_order.buyer_id'] = $condition['buyer_id'];        }        //关联表        $order = 'zero_order.order_state DESC,zero_order.add_time DESC';        $count = 0;        $list = $this->table('zero_order,zero_order_goods,zero_goods')->field($field)->where($new_condition)->join('left')->on('zero_order.order_id=zero_order_goods.order_id,zero_order_goods.goods_id = zero_goods.goods_id')->order($order)->page($page, $count)->select();        return $list;    }    /**     * 获取管理端订单列表     */    public function getAdminOrderList($condition, $field = '*', $group = '',$order = '', $limit = 0, $page = 0, $count = 0){        $list = $this->table('zero_order,zero_order_goods')->field($field)->where($condition)->group($group)->join('left')->on('zero_order.order_id=zero_order_goods.order_id')->order($order)->limit($limit)->page($page, $count)->select();        return $list;    }    /**     *     * 获取会员订单详情     * @param array $condition     */    public function getMemberOrderDetail($condition=array()){        //所需字段        $field = 'zero_order.*,zero_goods.*,zero_order_goods.goods_num';        $new_condition = array();        if($condition['order_id']){            $new_condition['zero_order.order_id'] = $condition['order_id'];        }        if($condition['buyer_id']){            $new_condition['zero_order.buyer_id'] = $condition['buyer_id'];        }        //关联表        $info = $this->table('zero_order,zero_order_goods,zero_goods')->field($field)->where($new_condition)->join('left')->on('zero_order.order_id=zero_order_goods.order_id,zero_order_goods.goods_id = zero_goods.goods_id')->find();        // 商品多图        $info['goods_image_list'] = explode(';', $info['goods_image_list']);        if(is_array($info['goods_image_list'])){            foreach ($info['goods_image_list'] as $k => $v) {                $info['goods_image_list'][$k] = UPLOAD_SITE_URL.DS.$v;            }        }        return $info;    }    /**     * 更新数据     *     * @param array $update 更新数据     * @param array $condition 条件     * @return boolean     */    public function editData($update, $condition) {        $result = $this->table('zero_order')->where($condition)->update($update);        return $result;    }    /**     * 获取单条信息     *     * @param array $condition     * @param string $field     * @return array     */    public function getInfo($condition, $field = '*') {        $info = $this->table('zero_order')->field($field)->where($condition)->find();        return $info;    }    /**     * 获得某字段的和     *     * @param array $condition     * @param string $field     * @return boolean     */    public function getSum($condition, $field) {        return $this->table('zero_order')->where($condition)->sum($field);    }    /**     * 获得数量     *     * @param array $condition     * @param string $field     * @return int     */    public function getCount($condition) {        return $this->table('zero_order')->where($condition)->count();    }    /**     * 删除信息     *     * @param array $condition     * @return boolean     */    public function delData($condition) {        return $this->table('zero_order')->where($condition)->delete();    }}